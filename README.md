Все файлы и каталоги в HDFS представлены в виде индексных дескрипторов (inodes), содержащих различные атрибуты, такие как привилегии, время последнего изменения, ограничение на дисковое пространство, ограничение на пространство namespace (например, количество inodes) и время последнего доступа.
### Компоненты

- **NameNode** является центральной нодой управления системой. Она обслуживает пространство имен (namespace) в HDFS, хранящееся в ее оперативной памяти и содержащее полную информацию о каталогах и файлах. NameNode также управляет распределением блоков файлов среди DataNodes.

- **Secondary NameNode** — это вспомогательный сервер, который периодически создает полный образ текущего содержимого пространства имен, то есть его контрольные точки (checkpoint). Он делает это путем обработки журнала транзакций с его последующей очисткой. Вспомогательный сервер обеспечивает доступ к checkpoint для NameNode, чтобы последняя могла в любое время обновить содержимое namespace в своей оперативной памяти. В случае сбоя на NameNode ее можно запустить заново, используя последний checkpoint и журнал транзакций.

- **DataNodes** — это большинство нод кластера, подчиняющихся NameNode и используемых для хранения данных и их обработки. Они исполняют запросы от клиентов на чтение и запись блоков данных.
![[Pasted image 20241127234112.png]]
### Принципы работы

По умолчанию фактор репликации равен трем, а размер блока — 128 МБ. Когда клиент создает файл в HDFS, он сначала разделяет файл на части по 128 МБ и затем записывает их в блоки HDFS. Размер каждого блока, за исключением последнего, будет 128 МБ. Размер последнего блока может быть 128 МБ или меньше в зависимости от общего объема записываемых данных. Размер блока по умолчанию можно настраивать.

Рассмотрим пример записи 500 МБ данных в файл HDFS. Эти данные будут разделены на 3 блока по 128 МБ и четвертый блок размером 116 МБ, как представлено на следующей схеме.

![[Pasted image 20241127234618.png]]
### Основные команды
Hadoop предоставляет два основных интерфейса для работы с файловой системой Hadoop Distributed File System (HDFS): команды `hadoop fs` и `hdfs dfs`.

- **hadoop fs**: Это более общий интерфейс, который может использоваться для работы с различными файловыми системами, поддерживаемыми Hadoop, включая локальную файловую систему, HDFS, Amazon S3 и другие. Это означает, что команды, начинающиеся с `hadoop fs`, могут быть использованы для взаимодействия с различными типами файловых систем.

- **hdfs dfs**: Этот интерфейс, как следует из названия, специально предназначен для работы с HDFS. Команды, начинающиеся с `hdfs dfs`, позволяют управлять файлами и директориями в распределенной файловой системе Hadoop. Этот интерфейс предоставляет более специализированные и оптимизированные команды для работы именно с HDFS.

| Описание                                                                                              | Синтаксис                                    | Пример                                                                   |     |
| :---------------------------------------------------------------------------------------------------- | :------------------------------------------- | :----------------------------------------------------------------------- | --- |
| Отображает список файлов и каталогов по указанному пути.                                              | `hdfs dfs -ls <path>`                        | `hdfs dfs -ls /home`                                                     |     |
| Создает новый каталог по указанному пути.                                                             | `hdfs dfs -mkdir <path>`                     | `hdfs dfs -mkdir /home`                                                  |     |
| Загрузка файла из локальной системы в HDFS.                                                           | `hdfs dfs -put <local> <hdfs>`               | `hdfs dfs -put `<br>`/home/filetxt.txt /user/hive/warehouse`             |     |
| Выгрузка файла **из** HDFS в локальную систему.                                                       | `hdfs dfs -get <hdfs> <local>`               | `hdfs dfs -get` `/user/hive/warehouse/filetxt.txt /home`                 |     |
| Удаление файла или каталога                                                                           | `hdfs dfs -rm <path>`                        | `hdfs dfs -rm` `/user/hive/warehouse/filetxt.txt`                        |     |
| Изменение размера репликации                                                                          | `hdfs dfs -setrep <replica_num>`<br>`<path>` | `hdfs dfs -setrep 3 /path/in/hdfs/file.txt`                              |     |
| Показывает использование дискового пространства по указанному пути.                                   | `hdfs dfs -du <path>`                        | `hdfs dfs -du /home`                                                     |     |
| Копирует файл из локальной файловой системы в HDFS (аналогично `put`).                                | `hdfs dfs -copyFromLocal <local> <hdfs>`     | `hdfs dfs -copyFromLocal /home/filetxt.txt /user/hive/warehouse`         |     |
| Копирует файл из HDFS в локальную файловую систему (аналогично `get`).                                | `hdfs dfs -copyToLocal <local> <hdfs>`       | `hdfs dfs -copyToLocal /user/hive/warehouse/filetxt.txt`<br>`home/`      |     |
| Перемещает файл из локальной файловой системы в HDFS (**удаляет файл из локалки после перемещения**). | `hdfs dfs -moveFromLocal <local> <hdfs>`     | `hdfs dfs -moveFromLocal /home/filetxt.txt` <br>`/home (аналогично put)` |     |
| Выводит содержимое указанного файла                                                                   | `hdfs dfs -cat <path>`                       | `hdfs dfs -cat /home/filename.txt`                                       |     |
| Изменяет права доступа к указанному файлу или каталогу.                                               | `hdfs dfs -chmod <mode> <path>`              | `hdfs dfs -chmod 777` <br>`/home/data`                                   |     |
| Изменяет владельца и группу указанного файла или каталога.                                            | `hdfs dfs -chown <owner>:<group> <path>`     | `hdfs dfs -chown` <br>`admin:management` <br>`/user/hive/warehouse`      |     |
| Отображает информацию о файловой системе HDFS.                                                        | `hdfs dfs -df <path>`                        | `hdfs dfs -df /user/hive/warehpuse`                                      |     |
| Показывает информацию о файле или каталоге по указанному пути.                                        | `hdfs dfs -stat <path>`                      | `hdfs dfs -stat` <br>`/user/hive/warehouse`                              |     |

Больше команд: https://docs.arenadata.io/ru/ADH/current/references/hdfs-cheatsheet.html

### Применение на практике

1. Поднимаем кластер командой `docker compose up -d`
![[Pasted image 20241128002955.png]]
2. Проверяем работу кластера: находим порт контейнера `namenode` и по его порту переходим в браузере в GUI головной ноды.
![[Pasted image 20241128003458.png]]
![[Pasted image 20241128003615.png]]
![[Pasted image 20241128003650.png]]
3. **Работа с HDFS:** 
	1. Входим в Hadoop: `docker exec -it namenode /bin/bash
	2. Проверяем окружение HDFS: `hdfs dfs -ls /`
![[Pasted image 20241128004340.png]]
Далее мы можем выполнять все команды, которые указаны выше для создания, удаления, копирования, перемещения и взаимодействия с файлами.
